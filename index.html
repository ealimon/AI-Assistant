<script>
		// CONFIG
		const DEMO_MODE = true; // Set to false after you deploy the backend
		const BACKEND_URL = "https://your-worker-subdomain.workers.dev/api/assistant-answer"; // Replace after deploying your API
		const IRRELEVANT_MESSAGE = "I'm sorry. I can only answer questions about Limon Media's digital marketing services, such as Google Ads, Website Design, or Google Business Profile optimization.";

		// Suggested questions (Limon Media Services - Final)
		const SUGGESTED_QUESTIONS = [
			"What are your website subscription costs?", // New Question for pricing
			"Where is Limon Media located?", // New Question for location
			"How long does a website design project take?",
			"Do you offer AI digital solutions?",
			"Who owns Limon Media?",
			"How can I contact your team?"
		];

		// Relevance guard (Limon Media Keywords - Final)
		const RELEVANCE_KEYWORDS = [
			"limon media","website design","google ads","google business profile","seo","digital marketing","online advertising","leads","sales",
			"roi","certified","consultation","process","pricing","cost","budget","team","experience","in-house",
            "ai","artificial intelligence","digital solutions", "edward", "alicia", "limon", "owner", "owners",
            "phone","email","contact","442-268-0928","less than 30 days","timeline",
            "coachella valley", "southern california", "location", "subscription", "$350", "$150", "yearly" // New Keywords
		];
		const isRelevant = (q) => {
			const s = (q || "").toLowerCase();
			return RELEVANCE_KEYWORDS.some(k => s.includes(k));
		};

		// Suggestion bypass flag
		let fromSuggestion = false;

		const box = document.getElementById("answer");

		function setLoading(loading) {
			const btn = document.getElementById("submit-btn");
			const sp = document.getElementById("btn-spinner");
			const bt = document.getElementById("btn-text");
			btn.disabled = loading;
			sp.style.display = loading ? "inline-block" : "none";
			bt.textContent = loading ? "Thinking…" : "Ask";
		}

		function showAnswer(text, opts = {}) {
			box.classList.remove("empty", "suggestions-mode");
			if (!text) {
				renderSuggestions();
			} else {
				// Added basic formatting support (like bolding keywords)
				let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
				box.innerHTML = formattedText;
				box.style.borderColor = "var(--border)";
				box.style.background = "var(--answer-bg)";
				if (opts.type === "error") {
					box.style.borderColor = "#fde2e2";
					box.style.background = "#fff7f7";
				}
			}
		}

		async function askBackend(question) {
			// This is where you would call your RAG backend API
			const res = await fetch(BACKEND_URL, {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ question })
			});
			if (!res.ok) throw new Error(await res.text());
			const data = await res.json();
			return data.answer || "";
		}

		// Demo answers tailored to Limon Media services (Final Update)
		function demoAnswer(question) {
			const q = question.toLowerCase();

			// Website Pricing (New)
			if (q.includes("subscription") || q.includes("cost") || q.includes("price") || q.includes("yearly") || q.includes("$")) {
				return "Our website services include a yearly subscription fee of **$350**, plus a one-time design fee of **$150 per designed page**. Please contact us for a detailed project quote!";
			}
			
			// Location (New)
			if (q.includes("location") || q.includes("where is") || q.includes("coachella valley")) {
				return "Limon Media is proudly located in the **Coachella Valley, Southern California**. We are happy to help with most digital marketing projects, regardless of your location.";
			}
            
			// Ownership/Experience
            if (q.includes("owner") || q.includes("edward") || q.includes("alicia") || q.includes("experience") || q.includes("who owns")) {
                let answer = "Limon Media is owned by **Edward and Alicia Limon**. We have been providing digital design services, including Google Ads, for **over 10 years**.";
                if (q.includes("ai")) {
                    answer += " We are now proud to also offer AI digital solutions.";
                }
                return answer;
            }
            
            // Contact Info
            if (q.includes("phone") || q.includes("email") || q.includes("reach") || q.includes("contact")) {
                return "You can reach us directly by phone at **442-268-0928** or by email at **Edward@Limon.Media**. You can also click the consultation button below.";
            }

			// Website Design & Timeline
			if (q.includes("website design") || q.includes("process") || q.includes("build") || q.includes("timeline") || q.includes("30 days")) {
				return "Our **professional website design** process creates visually compelling sites. A simple, professional website can typically be completed in **less than 30 days**.";
			}

            // AI Digital Solutions
            if (q.includes("ai") || q.includes("artificial intelligence") || q.includes("digital solutions")) {
                return "Yes! We now offer **AI digital solutions** to enhance our core services. This includes AI-powered tools to improve ad targeting, optimize website content, and streamline your digital strategy for better results.";
            }

			// Google Ads
			if (q.includes("google ads") || q.includes("roi") || q.includes("certified") || q.includes("budget")) {
				return "Limon Media specializes in **data-driven Google Ads campaigns**. We are **Google Ads Certified** and focus on targeted mobile ads, click-to-call, and maximizing your Return on Investment (ROI). We help you set a budget that delivers real results.";
			}

			// Google Business Profile
			if (q.includes("google business profile") || q.includes("local seo") || q.includes("local presence")) {
				return "**Google Business Profile Optimization** is key for local search. We establish a strong local presence, ensuring customers effortlessly find your business on Google Maps and search, driving high-quality local leads.";
			}

			// Consultation/Contact (Fallback)
			if (q.includes("consultation") || q.includes("request")) {
				return "You can request a **free consultation** by clicking the 'Get Your Free Consultation' button below or by calling us at **442-268-0928**.";
			}

			// Fallback (concise, with key services and experience)
			return "Limon Media offers **Website Design**, **Google Ads**, **Google Business Profile Optimization**, and new **AI Digital Solutions**. We are located in the Coachella Valley, Southern California, and have **over 10 years** of experience.";
		}

		function renderSuggestions() {
			box.classList.add("empty", "suggestions-mode");
			box.innerHTML = `
				<div class="suggestions">
					<h3>Suggested Questions about our Services</h3>
					<ul>
						${SUGGESTED_QUESTIONS.map(q => `<li data-q="${q.replace(/"/g, '')}">${q}</li>`).join("")}
					</ul>
				</div>
			`;
			box.querySelectorAll("li").forEach(li => {
				li.addEventListener("click", () => {
					const q = li.getAttribute("data-q");
					const input = document.getElementById("question");
					input.value = q;
					fromSuggestion = true;
					document.getElementById("ask-form").requestSubmit();
				});
			});
		}

		document.getElementById("ask-form").addEventListener("submit", async (e) => {
			e.preventDefault();
			const input = document.getElementById("question");
			const question = input.value.trim();
			if (!question) return;

			if (!fromSuggestion && !isRelevant(question)) {
				showAnswer(IRRELEVANT_MESSAGE);
				return;
			}

			setLoading(true);
			try {
				const answer = DEMO_MODE
					? (await new Promise(r => setTimeout(r, 750)), demoAnswer(question))
					: await askBackend(question);
				showAnswer(answer);
			} catch (err) {
				console.error(err);
				showAnswer("Sorry—we can't process that right now. Please try again or contact us directly.", { type: "error" });
			} finally {
				setLoading(false);
				input.focus();
				input.select();
				fromSuggestion = false;
			}
		});

		// Clear button: reset input and restore suggestions
		document.getElementById("clear-btn").addEventListener("click", () => {
			const input = document.getElementById("question");
			input.value = "";
			fromSuggestion = false;
			renderSuggestions();
			input.focus();
		});

		// Initial render
		renderSuggestions();
	</script>
